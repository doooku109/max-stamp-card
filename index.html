<!DOCTYPE html>
<html>
<head>
    <style>
        /* ... 他のスタイルは変更なし ... */
        /* ▼▼▼ 有効期限表示用のスタイルを追加 ▼▼▼ */
        #valid-term-info {
            margin-top: 15px;
            padding: 10px;
            background-color: #fffde7;
            border: 1px solid #ffc107;
            border-radius: 5px;
            display: inline-block;
        }
    </style>
</head>
<body>
    <h1>あなたのスタンプカード</h1>
    <div id="stamp-sheet"></div>

    <div id="valid-term-info">
        有効期限：(ボタンを押して確認)
    </div>

    <button id="load-stamps-btn">スタンプと履歴を更新</button>
    <hr style="margin-top: 20px;">
    <script>
        // ... Phase 1 と loadFirebaseAndGetData 関数は変更なし ...

        function initializeFirebaseAndRender(userId) {
            // ... Firebase初期化は変更なし ...

            db.collection("users").doc(userId).onSnapshot((doc) => {
                // ... スタンプと履歴の表示処理は変更なし ...

                // ▼▼▼ 有効期限を表示する処理を追加 ▼▼▼
                const validTermInfo = document.getElementById('valid-term-info');
                if (doc.exists && doc.data().firstStampDate) {
                    const firstStampDate = doc.data().firstStampDate;
                    const startDate = new Date(firstStampDate);
                    const oneYearLater = new Date(new Date(firstStampDate).setFullYear(startDate.getFullYear() + 1));
                    const today = new Date();
                    
                    let termText = `有効期限の開始日: ${firstStampDate}<br>`;
                    if (today < oneYearLater) {
                        termText += '<strong style="color: green;">1000円特典の対象期間内です</strong>';
                    } else {
                        termText += '<strong style="color: red;">1000円特典の対象期間外です</strong>';
                    }
                    validTermInfo.innerHTML = termText;
                } else {
                    validTermInfo.innerText = '有効期限：最初のスタンプ獲得で開始します';
                }
                // ▲▲▲ ここまで ▲▲▲

                // ... ボタンの表示を元に戻す処理は変更なし ...
            });
        }
    </script>
</body>
</html>
